{"remainingRequest":"/Users/warrenyang/Documents/mycode/2022/web-app/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/warrenyang/Documents/mycode/2022/web-app/src/views/dashboard/admin/index.vue?vue&type=style&index=0&id=a361ec26&lang=scss&scoped=true&","dependencies":[{"path":"/Users/warrenyang/Documents/mycode/2022/web-app/src/views/dashboard/admin/index.vue","mtime":1668331774000},{"path":"/Users/warrenyang/Documents/mycode/2022/web-app/node_modules/css-loader/dist/cjs.js","mtime":1668390099855},{"path":"/Users/warrenyang/Documents/mycode/2022/web-app/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1668390101778},{"path":"/Users/warrenyang/Documents/mycode/2022/web-app/node_modules/postcss-loader/src/index.js","mtime":1668390100174},{"path":"/Users/warrenyang/Documents/mycode/2022/web-app/node_modules/sass-loader/dist/cjs.js","mtime":1668390099108},{"path":"/Users/warrenyang/Documents/mycode/2022/web-app/node_modules/cache-loader/dist/cjs.js","mtime":1668390099165},{"path":"/Users/warrenyang/Documents/mycode/2022/web-app/node_modules/vue-loader/lib/index.js","mtime":1668390101491}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5kYXNoYm9hcmQtZWRpdG9yLWNvbnRhaW5lciB7CiAgcGFkZGluZzogMCAzMnB4OwogIGJhY2tncm91bmQtY29sb3I6IHJnYigyNDAsIDI0MiwgMjQ1KTsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgaGVpZ2h0OiAxMDB2aDsKICB3aWR0aDogMTAwJTsKCiAgLmluZm8tYmxvY2sgewogICAgcG9zaXRpb246IGZpeGVkOwogICAgcmlnaHQ6IDEwcHg7CiAgICB0b3A6IDEwcHg7CiAgICB3aWR0aDogMTgwcHg7CiAgICB6LWluZGV4OiA5OTsKICAgIGZvbnQtc2l6ZTogMTJweDsKICAgIGxpbmUtaGVpZ2h0OiAyMHB4OwogIH0KCiAgLm1haW4tYXJ0aWNsZS1jb250YWluZXIgewogICAgaGVpZ2h0OiAxMDAlOwogICAgd2lkdGg6IDEyMDBweDsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBtYXJnaW46IDAgYXV0bzsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CgogICAgLmFydGljbGUtaXRlbSB7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIGJsYWNrOwogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICB9CgogICAgLm1haW4tYXJ0aWNsZSB7CiAgICAgIGZsZXg6IDE7CiAgICAgIG92ZXJmbG93LXk6IGF1dG87CiAgICAgIHBhZGRpbmc6IDEycHg7CiAgICB9CgogICAgLm1vcmUtYXJ0aWNsZSB7CiAgICAgIGZsZXgtc2hyaW5rOiAwOwogICAgICBoZWlnaHQ6IDI0MHB4OwogICAgICBvdmVyZmxvdzogaGlkZGVuOwoKICAgICAgLm1vcmUtYXJ0aWNsZS1pdGVtIHsKICAgICAgICBwYWRkaW5nOiAxMnB4OwogICAgICAgIGhlaWdodDogMjQwcHg7CiAgICAgIH0KICAgIH0KICB9Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0MA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/dashboard/admin","sourcesContent":["<template>\n  <div class=\"dashboard-editor-container\">\n    <div class=\"main-article-container\">\n      <div class=\"main-article article-item\" area-name=\"main\">\n        {{ mainArticle.item }}\n      </div>\n      <div v-loading=\"loading\" class=\"more-article\">\n        <el-row>\n          <el-col v-for=\"(article, index) in moreArtcleList\" :key=\"index\" :xs=\"24\" :sm=\"24\" :lg=\"8\">\n            <div class=\"more-article-item article-item\" :area-name=\"'article' + (index + 1)\">\n              {{ article.item }}\n            </div>\n          </el-col>\n        </el-row>\n      </div>\n    </div>\n\n    <div class=\"info-block\">\n      当前追踪刷新率 300 ms\n      <br>\n      主区域停留推荐阈值\n      <el-input v-model=\"resetRecommedTime\" size=\"mini\">\n        <template slot=\"append\">ms</template>\n      </el-input>\n      <br>\n      其他域停留推荐阈值\n      <el-input v-model=\"changeToMainTime\" size=\"mini\">\n        <template slot=\"append\">ms</template>\n      </el-input>\n      <el-divider />\n      当前处于 {{ eyePotiner.areaName }} 区域\n      <br>\n      停留时长 {{ ((eyePotiner.nowTimestamp - eyePotiner.startTimestamp) / 1000).toFixed(1) }} s\n      <br>\n      上次推荐间隔时长 {{ ((eyePotiner.nowTimestamp - eyePotiner.resetRecommedTimestamp) / 1000).toFixed(1) }} s\n      <br>\n      x: {{ eyePotiner.x.toFixed(1) }}\n      <br>\n      y: {{ eyePotiner.y.toFixed(1) }}\n    </div>\n  </div>\n</template>\n\n<script>\nimport $ from 'jquery'\nconst refreshTime = 300\n\nconst throttle = (func, wait = 50) => {\n  // 上一次执行该函数的时间\n  let lastTime = 0\n  return function(...args) {\n    // 当前时间\n    const now = +new Date()\n    // 将当前时间和上一次执行函数时间对比\n    // 如果差值大于设置的等待时间就执行函数\n    if (now - lastTime > wait) {\n      lastTime = now\n      func.apply(this, args)\n    }\n  }\n}\n\nexport default {\n  name: 'DashboardAdmin',\n  components: {},\n  data() {\n    return {\n      mainArticle: '',\n      moreArtcleList: [],\n      eyePotiner: {\n        x: 0,\n        y: 0,\n        areaName: '-',\n        startTimestamp: 0,\n        resetRecommedTimestamp: 0, // 重新推荐时间\n        nowTimestamp: 0\n      },\n      areas: [],\n      csvData: [],\n      changeToMainTime: 3000,\n      resetRecommedTime: 5000,\n      loading: false\n    }\n  },\n  watch: {\n    csvData(newVal) {\n      if (newVal.length !== 0) {\n        this.mainArticle = newVal[0]\n        this.moreArtcleList = newVal.filter((value, index, array) => index > 0)\n        this.$nextTick(() => {\n          this.getAreas()\n        })\n      }\n    },\n    'eyePotiner.areaName'(newVal) {\n      this.hasChanged = false\n    }\n  },\n  mounted() {\n    window.saveDataAcrossSessions = true\n    window.webgazer\n      .setGazeListener((data, timestamp) => {\n        // console.log(data, timestamp)\n        this.caculatePosition(data, timestamp)\n      }).begin()\n\n    this.getRecommond()\n  },\n  methods: {\n    caculatePosition: throttle(function(data, timestamp) {\n      if (data == null) return\n\n      const { x, y } = data\n      this.eyePotiner.x = x\n      this.eyePotiner.y = y\n\n      // 获取停留区域名称\n      const areaName = this.checkInWitchArea(x, y)\n      // 如果区域名称有变化，则更新时间\n      if (this.eyePotiner.areaName !== areaName) {\n        this.eyePotiner.areaName = areaName\n        this.eyePotiner.startTimestamp = timestamp\n        this.eyePotiner.resetRecommedTimestamp = timestamp\n      }\n      this.eyePotiner.nowTimestamp = timestamp\n\n      // 如果没在可视区域，则不继续了\n      if (!this.eyePotiner.areaName) {\n        return\n      }\n\n      if (this.eyePotiner.areaName !== 'main' && (this.eyePotiner.nowTimestamp - this.eyePotiner.resetRecommedTimestamp) > this.changeToMainTime) {\n        // 非主区域3s以上，切换文章到主区域\n        const activeAreaIndex = this.areas.findIndex((value) => value.areaName === this.eyePotiner.areaName)\n        this.csvData.splice(0, 1, JSON.parse(JSON.stringify(this.csvData[activeAreaIndex])))\n        // console.log(JSON.stringify(this.csvData))\n        this.$nextTick(() => {\n          this.getRecommond()\n          this.eyePotiner.resetRecommedTimestamp = timestamp\n        })\n      } else if (this.eyePotiner.areaName === 'main' && (this.eyePotiner.nowTimestamp - this.eyePotiner.resetRecommedTimestamp) > this.resetRecommedTime) {\n        // 主区域5s以上，且推荐时间超过5s，重新请求一下下方的推荐\n        this.getRecommond()\n        this.eyePotiner.resetRecommedTimestamp = timestamp\n      }\n    }, refreshTime),\n    getAreas() {\n      const articles = document.getElementsByClassName('article-item')\n      const areas = []\n      articles.forEach((value) => {\n        const { top, left } = $(value).offset()\n        areas.push({\n          top,\n          left,\n          width: $(value).width(),\n          height: $(value).height(),\n          areaName: $(value).attr('area-name')\n        })\n      })\n      this.areas = areas\n      console.log(this.areas)\n    },\n    checkInWitchArea(x, y) {\n      let areaName = ''\n      for (let i = 0; i < this.areas.length; i++) {\n        const area = this.areas[i]\n        if (x > area.left && x < (area.left + area.width) && y > area.top && y < (area.top + area.height)) {\n          areaName = area.areaName\n          break\n        }\n      }\n\n      return areaName\n    },\n    getRecommond() {\n      this.loading = true\n      let first\n      if (this.csvData.length !== 0) {\n        first = JSON.parse(JSON.stringify(this.csvData[0]))\n      }\n      setTimeout(() => {\n        const csvData = first ? [first] : []\n        const csvDataInitLength = 0\n        for (let i = 0; i < 4 - csvDataInitLength; i++) {\n          const randomValue = this.random(0, 10000)\n          csvData.push({\n            item: `${randomValue} 圆梦中国人”百姓宣讲活动今天启动`,\n            value: randomValue\n          })\n        }\n        this.csvData = csvData\n        this.loading = false\n      }, 600)\n    },\n    random(a, b) { // 随机函数  随机生成a和b之间的一个数\n      return Math.round(Math.random() * (b - a) + a) // 公式\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dashboard-editor-container {\n  padding: 0 32px;\n  background-color: rgb(240, 242, 245);\n  position: relative;\n  height: 100vh;\n  width: 100%;\n\n  .info-block {\n    position: fixed;\n    right: 10px;\n    top: 10px;\n    width: 180px;\n    z-index: 99;\n    font-size: 12px;\n    line-height: 20px;\n  }\n\n  .main-article-container {\n    height: 100%;\n    width: 1200px;\n    display: flex;\n    margin: 0 auto;\n    flex-direction: column;\n\n    .article-item {\n      border: 1px solid black;\n      text-align: center;\n    }\n\n    .main-article {\n      flex: 1;\n      overflow-y: auto;\n      padding: 12px;\n    }\n\n    .more-article {\n      flex-shrink: 0;\n      height: 240px;\n      overflow: hidden;\n\n      .more-article-item {\n        padding: 12px;\n        height: 240px;\n      }\n    }\n  }\n}\n</style>\n"]}]}